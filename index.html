<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Panel de Monitoreo ‚Äî Ci√©naga Grande de Santa Marta</title>

<!-- Chart.js, MathJax y Leaflet -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --good:#0ea5a4; --warn:#facc15; --danger:#ef4444;
  --panel:rgba(5,25,35,0.6); --text:#eaf6f8;
}
*{box-sizing:border-box}
body{
  margin:0;
  color:var(--text);
  font-family:"Segoe UI",Roboto,sans-serif;
  overflow-x:hidden;
  background:radial-gradient(circle at 50% 20%, #0a3344 0%, #041f29 80%);
  min-height:100vh;
}

/* Fondo animado: agua + algas */
.bg{
  position:fixed; inset:0;
  background:
   radial-gradient(circle at 20% 30%, rgba(16,185,129,0.1) 0%, transparent 40%),
   radial-gradient(circle at 80% 60%, rgba(6,182,212,0.08) 0%, transparent 40%),
   repeating-radial-gradient(circle at 50% 50%, rgba(255,255,255,0.02) 0, rgba(255,255,255,0.02) 2px, transparent 3px, transparent 6px);
  animation:moveBg 18s linear infinite alternate;
  z-index:-2;
}
@keyframes moveBg{
  from{background-position:0 0,0 0,0 0}
  to{background-position:10px 20px, -10px -20px, 20px 10px}
}
/* algas flotando */
.alga{
  position:fixed;
  width:80px; height:180px;
  background:linear-gradient(180deg,rgba(34,197,94,0.25),rgba(34,197,94,0.05));
  border-radius:40% 60% 40% 60%;
  animation:float 20s ease-in-out infinite;
  filter:blur(2px);
  z-index:-1;
}
.alga:nth-child(1){left:10%;bottom:0;animation-delay:0s;}
.alga:nth-child(2){left:40%;bottom:0;animation-delay:5s;}
.alga:nth-child(3){left:70%;bottom:0;animation-delay:10s;}
@keyframes float{
  0%,100%{transform:translateY(0) rotate(0deg)}
  50%{transform:translateY(-30px) rotate(2deg)}
}

/* contenedores */
main{max-width:1200px;margin:auto;padding:20px;}
h1{text-align:center;margin:0 0 10px;}
p.lead{text-align:center;margin:0 0 20px;color:#b6e2e0;}
.panel{
  background:var(--panel);
  backdrop-filter:blur(10px);
  border-radius:18px;
  padding:18px;
  box-shadow:0 10px 20px rgba(0,0,0,0.4);
}
.grid{display:grid;grid-template-columns:1fr 380px;gap:20px;}
@media(max-width:950px){.grid{grid-template-columns:1fr;}}

.card{background:rgba(255,255,255,0.03);border-radius:12px;padding:12px;margin-bottom:12px;}
canvas{max-width:100%;}
.small{color:#bcd7d6;font-size:0.85rem;}
.btn{background:#06b6d4;color:#031b24;border:none;border-radius:6px;padding:8px 12px;font-weight:700;cursor:pointer;}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.15);color:#c0dcdc}
.salinity-control{text-align:center;margin-top:10px;}
.salinity-control input[type=range]{width:90%;max-width:420px;}
.sal-value{font-weight:700;color:#06b6d4;}
#map{height:300px;border-radius:10px;overflow:hidden;margin-top:10px;}
.status-box{margin-top:8px;}
.dot{width:16px;height:16px;border-radius:50%;display:inline-block;margin-right:6px;vertical-align:middle;}

/* modelo matem√°tico */
.model{margin-top:25px;padding:20px;background:rgba(255,255,255,0.05);border-radius:14px;}
.formula{text-align:center;color:#a6dbd5;}
.model-controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:12px 0;}
.model-controls input{width:90px;padding:5px;background:rgba(255,255,255,0.1);border:none;border-radius:4px;color:white;}
.model-charts{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
@media(max-width:800px){.model-charts{grid-template-columns:1fr;}}
.interpret{text-align:center;margin-top:10px;color:#c8e5e3;}
footer{text-align:center;margin:18px 0;color:#a0c7c4;font-size:0.9rem;}
</style>
</head>
<body>
<div class="bg"></div>
<div class="alga"></div><div class="alga"></div><div class="alga"></div>

<main>
  <h1>üåø Panel de Monitoreo ‚Äî Ci√©naga Grande de Santa Marta</h1>
  <p class="lead">Simulaci√≥n ambiental y matem√°tica: relaci√≥n entre salinidad, turbidez y crecimiento de <em>Hydrilla verticillata</em></p>

  <div class="panel">
    <div class="grid">
      <div class="card">
        <strong>Turbidez (FTU)</strong>
        <canvas id="turbChart"></canvas>
      </div>
      <div class="card">
        <div class="small">Turbidez actual: <span id="curTurb">--</span> FTU</div>
        <div class="small">Nivel de agua: <span id="curLvl">--</span> m</div>
        <div class="small">Tiempo: <span id="curTime">0.0</span> min</div>
        <div style="margin-top:10px;">
          <button id="btnStart" class="btn">Iniciar</button>
          <button id="btnPause" class="btn ghost">Pausar</button>
          <button id="btnReset" class="btn ghost">Reset</button>
        </div>
        <div class="salinity-control">
          <div><strong>Salinidad (g/L)</strong></div>
          <input id="salSlider" type="range" min="10" max="35" step="1" value="25">
          <div class="sal-value" id="salText">25 g/L</div>
        </div>
        <div class="status-box">
          <div><span id="semDot" class="dot" style="background:var(--good)"></span><span id="semMsg">Agua en condiciones normales</span></div>
          <div id="advice" class="small"></div>
        </div>
        <div id="map"></div>
      </div>
    </div>
  </div>

  <div class="model">
    <h2 style="text-align:center">üìà Simulaci√≥n matem√°tica</h2>
    <div class="formula">
      \(S(t)=S_0e^{-\beta t}, \quad r(t)=e^{-\alpha(S(t)-10)^2}\)
    </div>
    <div class="model-controls">
      <label>S‚ÇÄ<input id="S0" type="number" value="25" step="0.1"></label>
      <label>Œ±<input id="alpha" type="number" value="0.02" step="0.01"></label>
      <label>Œ≤<input id="beta" type="number" value="0.1" step="0.01"></label>
      <label>Tiempo max (semanas)<input id="tmax" type="number" value="12"></label>
      <button id="btnCalcModel" class="btn">Calcular</button>
    </div>
    <div class="model-charts">
      <div class="card"><canvas id="salChart"></canvas></div>
      <div class="card"><canvas id="rChart"></canvas></div>
    </div>
    <p id="modelInterpret" class="interpret"></p>
  </div>
  <footer>Proyecto educativo ‚Äî Ingenier√≠a Ambiental y de Software ¬∑ Ci√©naga Grande de Santa Marta</footer>
</main>

<script>
/*=== CONFIGURACI√ìN GENERAL ===*/
const salSlider=document.getElementById("salSlider"),salText=document.getElementById("salText"),semDot=document.getElementById("semDot"),semMsg=document.getElementById("semMsg"),advice=document.getElementById("advice"),curTurb=document.getElementById("curTurb"),curLvl=document.getElementById("curLvl"),curTime=document.getElementById("curTime");
const btnStart=document.getElementById("btnStart"),btnPause=document.getElementById("btnPause"),btnReset=document.getElementById("btnReset");

/*=== MAPA ===*/
const map=L.map("map",{zoomControl:false}).setView([10.95,-74.5],9);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:""}).addTo(map);
L.circle([10.75,-74.8],{radius:8000,color:"#ef4444",fillColor:"#ef4444",fillOpacity:.08}).addTo(map).bindPopup("Entrada del r√≠o Magdalena ‚Äî alta sedimentaci√≥n");
L.circle([10.95,-74.5],{radius:7000,color:"#facc15",fillColor:"#facc15",fillOpacity:.06}).addTo(map).bindPopup("Zona central ‚Äî turbidez moderada");
L.circle([11.1,-74.3],{radius:6000,color:"#10b981",fillColor:"#10b981",fillOpacity:.05}).addTo(map).bindPopup("Salida al mar Caribe ‚Äî agua m√°s limpia");

/*=== TURBIDEZ ===*/
const turbCtx=document.getElementById("turbChart").getContext("2d");
const turbChart=new Chart(turbCtx,{type:"line",data:{labels:[],datasets:[{label:"Turbidez (FTU)",data:[],borderColor:"#06b6d4",tension:.3,fill:true,backgroundColor:"rgba(6,182,212,0.1)"}]},options:{scales:{x:{title:{display:true,text:"Tiempo (min)"},ticks:{color:"#bcd7d6"}},y:{min:0,max:150,ticks:{color:"#bcd7d6"}}},plugins:{legend:{labels:{color:"#bcd7d6"}}}}});

let targetSal=parseFloat(localStorage.getItem("sal")||25),currentSal=targetSal,smoothing=.06,simSeconds=0,turbTimer=null,running=false;
salSlider.value=targetSal;salText.textContent=targetSal+" g/L";updateSem(targetSal);

function computeTurbidity(sal,t){const m=t/60;let base=55+Math.sin(m*2)*18,eff=0;if(sal<20)eff=18-(sal-10)*.8;else if(sal<25)eff=-12;else if(sal<=30)eff=-6;else eff=(sal-30)*3+6;const n=(Math.random()-.5)*4;let turb=base+eff+n;return Math.max(5,Math.min(150,Math.round(turb*10)/10))}
function tick(){currentSal+= (targetSal-currentSal)*smoothing;const turb=computeTurbidity(currentSal,simSeconds);const lvl=(1.5+Math.sin(simSeconds/120)*.2).toFixed(2);
curTurb.textContent=turb+" FTU";curLvl.textContent=lvl+" m";simSeconds++;curTime.textContent=(simSeconds/60).toFixed(1);
if(turbChart.data.labels.length>40){turbChart.data.labels.shift();turbChart.data.datasets[0].data.shift();}
turbChart.data.labels.push((simSeconds/60).toFixed(1));turbChart.data.datasets[0].data.push(turb);turbChart.update();}

btnStart.onclick=()=>{if(!running){running=true;turbTimer=setInterval(tick,1000);}}
btnPause.onclick=()=>{if(running){running=false;clearInterval(turbTimer);turbTimer=null;btnPause.textContent="Reanudar";}else{running=true;turbTimer=setInterval(tick,1000);btnPause.textContent="Pausar";}}
btnReset.onclick=()=>{running=false;clearInterval(turbTimer);turbTimer=null;simSeconds=0;turbChart.data.labels=[];turbChart.data.datasets[0].data=[];turbChart.update();curTurb.textContent="--";curLvl.textContent="--";curTime.textContent="0.0";btnPause.textContent="Pausar";}

/*=== SLIDER SALINIDAD ===*/
salSlider.oninput=()=>{targetSal=parseFloat(salSlider.value);salText.textContent=targetSal+" g/L";updateSem(targetSal);localStorage.setItem("sal",targetSal);}
function updateSem(v){
 if(v>30){semDot.style.background="var(--danger)";semMsg.textContent="üö´ Exceso de salinidad";advice.textContent="El exceso (>30 g/L) da√±a peces y manglares.";}
 else if(v>=25){semDot.style.background="var(--warn)";semMsg.textContent="‚ö† L√≠mite alto";advice.textContent="Te acercas al m√°ximo recomendado (30 g/L).";}
 else if(v>=20){semDot.style.background="var(--good)";semMsg.textContent="üîç Rango medio";advice.textContent="Control moderado de Hydrilla.";}
 else{semDot.style.background="var(--good)";semMsg.textContent="Agua dulce";advice.textContent="Condiciones que favorecen crecimiento de algas.";}
 const body=document.body;
 if(v>30)body.style.background="radial-gradient(circle at 50% 20%,#3a1a1a 0%,#1a0505 80%)";
 else if(v>=25)body.style.background="radial-gradient(circle at 50% 20%,#1b3f3f 0%,#0a1d23 80%)";
 else if(v>=20)body.style.background="radial-gradient(circle at 50% 20%,#0b3c36 0%,#042422 80%)";
 else body.style.background="radial-gradient(circle at 50% 20%,#0a3344 0%,#041f29 80%)";
}

/*=== MODELO MATEM√ÅTICO ===*/
const S0=document.getElementById("S0"),alpha=document.getElementById("alpha"),beta=document.getElementById("beta"),tmax=document.getElementById("tmax"),btnCalc=document.getElementById("btnCalcModel"),modelInterpret=document.getElementById("modelInterpret");
const salCtx=document.getElementById("salChart").getContext("2d"),rCtx=document.getElementById("rChart").getContext("2d");
const salChart=new Chart(salCtx,{type:"line",data:{labels:[],datasets:[{label:"S(t)",data:[],borderColor:"#3b82f6"}]},options:{scales:{x:{title:{display:true,text:"Semanas"},ticks:{color:"#bcd7d6"}},y:{title:{display:true,text:"Salinidad (g/L)"},ticks:{color:"#bcd7d6"}}},plugins:{legend:{labels:{color:"#bcd7d6"}}}}});
const rChart=new Chart(rCtx,{type:"line",data:{labels:[],datasets:[{label:"r(t)",data:[],borderColor:"#10b981"}]},options:{scales:{x:{title:{display:true,text:"Semanas"},ticks:{color:"#bcd7d6"}},y:{min:0,max:1,ticks:{color:"#bcd7d6"}}},plugins:{legend:{labels:{color:"#bcd7d6"}}}}});

function calcModel(){
 const S0v=parseFloat(S0.value),av=parseFloat(alpha.value),bv=parseFloat(beta.value),tm=parseFloat(tmax.value);
 const labs=[],Svals=[],Rvals=[];
 for(let t=0;t<=tm;t+=.5){labs.push(t.toFixed(1));const s=S0v*Math.exp(-bv*t);const r=Math.exp(-av*Math.pow(s-10,2));Svals.push(s.toFixed(2));Rvals.push(r.toFixed(3));}
 salChart.data.labels=labs;salChart.data.datasets[0].data=Svals;salChart.update();
 rChart.data.labels=labs;rChart.data.datasets[0].data=Rvals;rChart.update();
 let msg="";if(S0v>30)msg="Salinidad >30 g/L: reduce crecimiento de Hydrilla y da√±a ecosistema (peces, manglares).";
 else if(S0v>=25)msg="Salinidad alta (25‚Äì30): controla Hydrilla, monitorear especies sensibles.";
 else if(S0v>=20)msg="Rango ideal (20‚Äì25): equilibrio ecol√≥gico y control moderado.";
 else msg="Baja salinidad (<20): favorece proliferaci√≥n de Hydrilla y eutrofizaci√≥n.";
 modelInterpret.textContent=msg;
 localStorage.setItem("S0",S0v);localStorage.setItem("alpha",av);localStorage.setItem("beta",bv);localStorage.setItem("tmax",tm);
}
btnCalc.onclick=calcModel;
S0.value=localStorage.getItem("S0")||25;alpha.value=localStorage.getItem("alpha")||0.02;beta.value=localStorage.getItem("beta")||0.1;tmax.value=localStorage.getItem("tmax")||12;calcModel();
if(window.MathJax)MathJax.typesetPromise();
</script>
</body>
</html>
